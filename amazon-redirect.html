<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amazon App Redirect Test</title>
<!--     <h1 id="ua"> UserAgent </h1>
    <h1 id="results">Testing</h1> -->
</head>
<body>
<script>
    function isMobileDevice() {
        let hasTouchScreen = false;
        if ("maxTouchPoints" in navigator) {
          hasTouchScreen = navigator.maxTouchPoints > 0;
        } else if ("msMaxTouchPoints" in navigator) {
          hasTouchScreen = navigator.msMaxTouchPoints > 0;
        } else {
          const mQ = matchMedia?.("(pointer:coarse)");
          if (mQ?.media === "(pointer:coarse)") {
            hasTouchScreen = !!mQ.matches;
          } else if ("orientation" in window) {
            hasTouchScreen = true; // deprecated, but good fallback
          } else {
            // Only as a last resort, fall back to user agent sniffing
            const UA = navigator.userAgent;
            hasTouchScreen =
              /\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(UA) ||
              /\b(Android|Windows Phone|iPad|iPod)\b/i.test(UA);
          }
        }
        return hasTouchScreen;
        //return /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    
    
    window.onload = function() {
        var deepLink = 'com.amazon.mobile.shopping.web://www.amazon.com/MenstrEaze-Support-Hormone-Magnesium-Vitamins/dp/B0CMGZTPJZ?maas=maas_adg_4214D112E22120189A3FC3E3F17B4E33_afap_abs&ref_=aa_maas&tag=maas';
        var fallbackLink = 'https://www.amazon.com/MenstrEaze-Support-Hormone-Magnesium-Vitamins/dp/B0CMGZTPJZ?maas=maas_adg_4214D112E22120189A3FC3E3F17B4E33_afap_abs&ref_=aa_maas&tag=maas';
        // var ua = document.getElementById("ua");
        // var results = document.getElementById("results");
        // ua.innerHTML = navigator.userAgent;
        console.log("running");
        if (isMobileDevice()) {
            // 如果是移动设备，尝试打开深度链接
            console.log("try to open the deeplink");
            window.location.replace(deepLink);
            setTimeout(function() {
                // 检查用户是否还在当前页面
                 console.log("check back");
                if (document.visibilityState === 'visible') {
                    console.log("page still visible");
                    window.location.href = fallbackLink;
                }
            }, 2500); // 2.5秒后执行，这个时间可以根据实际情况调整
        } else {
            // 如果是桌面端，直接打开备用链接
            window.location.href = fallbackLink;
        }
    };
</script>

</body>
</html>

